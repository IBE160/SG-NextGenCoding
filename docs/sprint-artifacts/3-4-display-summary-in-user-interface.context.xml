<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>4</storyId>
    <title>Display Summary in User Interface</title>
    <status>drafted</status>
    <generatedAt>2025-12-04</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/3-4-display-summary-in-user-interface.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a user,</asA>
    <iWant>I want to view my generated summary clearly and intuitively,</iWant>
    <soThat>So that I can easily review the key points.</soThat>
    <tasks>
      ### Frontend Development

      *   **Design & Implement Summary Display Page (`frontend/src/app/summaries/[document_id]/page.tsx`)**
          *   Create a dedicated Next.js page for displaying a single summary.
          *   Implement UI layout to present the summary prominently.
          *   Integrate a markdown rendering library (e.g., `react-markdown`) to display `summary_text`.
          *   Add a "Copy Summary" button/icon with associated clipboard functionality (e.g., `react-copy-to-clipboard`).
          *   Implement loading states (e.g., skeleton UI, spinner) for when the summary is being fetched.
          *   Handle error states (e.g., summary not found, generation failed) with user-friendly messages.
      *   **Extend Frontend API Service (`frontend/src/services/documents.ts`)**
          *   Create function `getSummary(documentId: UUID)` to call `GET /api/v1/documents/{document_id}/summary`.
          *   Create function `getSummaryStatus(documentId: UUID)` to call `GET /api/v1/documents/{document_id}/status`.
          *   Implement polling mechanism for `getSummaryStatus` to update UI automatically once summary is ready.
      *   **Integrate with Zustand Store (`frontend/src/lib/store.ts`)**
          *   Define state slices for managing summary data, loading status, and errors.
          *   Update the store with fetched summaries and status changes.
      *   **Navigation Integration**
          *   Ensure smooth navigation to the summary display page (e.g., from an upload success screen or a user's document list).

      ### Testing

      *   **Unit Tests (Frontend `jest`)**:
          *   Test markdown rendering component with various markdown inputs.
          *   Test clipboard copy functionality.
          *   Test state management updates for loading, success, and error states.
      *   **Integration Tests (Frontend `jest`)**:
          *   Test `getSummary` and `getSummaryStatus` service functions, mocking backend API responses.
          *   Test polling logic for summary status.
      *   **E2E Tests (Playwright/Cypress)**:
          *   Simulate a user uploading a file, waiting for summary generation (mocked), and navigating to view the summary.
          *   Verify summary content is displayed correctly and can be copied.
          *   Test responsiveness across different device viewports.
          *   Test error scenarios: summary generation failed, summary not found.
      *   **Manual UI/UX Review**:
          *   Visually inspect the summary display for clarity, intuition, and adherence to design principles.
    </tasks>
  </story>

  <acceptanceCriteria>
    1.  **FR-CIP-2**: When a summary is successfully generated (from Story 3.3) and available, the frontend can fetch it using `GET /api/v1/documents/{document_id}/summary`.
    2.  **FR-CIP-2**: The summary content, including formatting (e.g., headings, bullet points), is correctly rendered in the UI using a markdown renderer component.
    3.  **FR-CIP-2**: The UI includes a clearly visible and functional button/icon to copy the entire summary text to the user's clipboard.
    4.  **FR-CIP-2**: The UI provides clear visual feedback (e.g., a loading spinner or skeleton screen) while the summary is being fetched or generated.
    5.  **FR-CIP-2**: The UI displays a user-friendly message if summary generation has failed or the summary is not yet available.
    6.  **FR-UI-1**: The summary display page is responsive and maintains readability and usability across desktop, laptop, and tablet screen sizes.
    7.  **FR-UI-1**: Navigation to the summary view is intuitive from the main application flow (e.g., after successful upload and generation).
    8.  **FR-CIP-2**: The system handles large summaries efficiently, ensuring the UI remains responsive and loads content without excessive delays.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact>
        <path>docs/PRD.md</path>
        <title>ibe160 - Product Requirements Document</title>
        <section>2. Content Ingestion &amp; Processing (FR-CIP)</section>
        <snippet>FR-CIP-2: Users can view the generated summary in a clear, readable format.</snippet>
      </artifact>
      <artifact>
        <path>docs/PRD.md</path>
        <title>ibe160 - Product Requirements Document</title>
        <section>Functional Requirements</section>
        <snippet>FR-UI-1: Responsive User Interface: The system shall provide a responsive web interface compatible with modern browsers (Chrome, Firefox, Safari, Edge) on desktop, laptop, and tablet devices. Core functionalities are fully accessible and usable via keyboard navigation. WCAG 2.1 AA accessibility guidelines must be met.</snippet>
      </artifact>
      <artifact>
        <path>docs/PRD.md</path>
        <title>ibe160 - Product Requirements Document</title>
        <section>User Experience Principles</section>
        <snippet>Intuitive History &amp; Review: Simple navigation to review past summaries, quiz attempts, and overall learning progress. Effortless File Upload: Clear, drag-and-drop or simple file selection interface with immediate visual feedback.</snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Epic to Architecture Mapping</section>
        <snippet>Epic 3: Content Ingestion &amp; AI Summarization -&gt; frontend/src/app/upload/, frontend/src/services/, backend/app/api/summaries/.</snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Technology Stack Details</section>
        <snippet>Frontend: Next.js 16.0.3, TypeScript, React, Tailwind CSS, Shadcn UI. Frontend State Management: Zustand 5.0.8. API Client (Frontend): Axios 1.13.2.</snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Implementation Patterns</section>
        <snippet>Loading States: Clear indicators (spinners, skeleton loaders). Error Recovery: Toast notifications, inline messages with retry.</snippet>
      </artifact>
      <artifact>
        <path>docs/epics.md</path>
        <title>ibe160 - Epic Breakdown</title>
        <section>Epic 3: Content Ingestion &amp; AI Summarization</section>
        <snippet>Scope: displaying the summary in the UI.</snippet>
      </artifact>
    </docs>
    <code>
      <artifact>
        <path>frontend/src/app/summaries/[document_id]/page.tsx</path>
        <kind>Next.js Page/React Component</kind>
        <symbol>SummaryDisplayPage</symbol>
        <reason>Dedicated page for displaying the generated summary, including markdown rendering and copy functionality.</reason>
      </artifact>
      <artifact>
        <path>frontend/src/services/documents.ts</path>
        <kind>TypeScript Service</kind>
        <symbol>getSummary, getSummaryStatus</symbol>
        <reason>Functions to fetch summary content and poll for generation status from the backend API.</reason>
      </artifact>
      <artifact>
        <path>frontend/src/lib/store.ts</path>
        <kind>Zustand Store</kind>
        <reason>Integration with Zustand to manage UI state related to summary data, loading status, and errors.</reason>
      </artifact>
      <artifact>
        <path>frontend/package.json</path>
        <kind>npm package</kind>
        <symbol>react-markdown, react-copy-to-clipboard</symbol>
        <reason>Third-party libraries for markdown rendering and clipboard functionality.</reason>
      </artifact>
    </code>
    <dependencies>
      <nodejs>
        <package name="@hookform/resolvers" version="^5.2.2"/>
        <package name="@next/bundle-analyzer" version="^14.0.4"/>
        <package name="@radix-ui/react-dialog" version="^1.1.15"/>
        <package name="@radix-ui/react-dropdown-menu" version="^2.0.6"/>
        <package name="@radix-ui/react-icons" version="^1.3.0"/>
        <package name="@radix-ui/react-label" version="^2.1.8"/>
        <package name="@radix-ui/react-slot" version="^1.0.2"/>
        <package name="@radix-ui/react-toast" version="^1.2.15"/>
        <package name="@supabase/ssr" version="^0.1.0"/>
        <package name="@supabase/supabase-js" version="^2.39.3"/>
        <package name="@tanstack/react-query" version="^5.17.15"/>
        <package name="@tanstack/react-query-devtools" version="^5.17.15"/>
        <package name="@vercel/analytics" version="^1.1.1"/>
        <package name="axios" version="^1.6.5"/>
        <package name="class-variance-authority" version="^0.7.0"/>
        <package name="clsx" version="^2.1.0"/>
        <package name="geist" version="^1.0.0"/>
        <package name="lucide-react" version="^0.304.0"/>
        <package name="next" version="^14.1.0"/>
        <package name="next-themes" version="^0.2.1"/>
        <package name="nextjs-toploader" version="^1.6.4"/>
        <package name="react" version="18.2.0"/>
        <package name="react-dom" version="18.2.0"/>
        <package name="react-hook-form" version="^7.67.0"/>
        <package name="tailwind-merge" version="^2.2.0"/>
        <package name="undici" version="^5.28.2"/>
        <package name="zod" version="^4.1.13"/>
        <package name="react-markdown" version="^X.X.X"/> (Placeholder, needs to be installed)
        <package name="react-copy-to-clipboard" version="^X.X.X"/> (Placeholder, needs to be installed)
      </nodejs>
      <python>
        <package name="fastapi" version="^0.122.0"/>
        <package name="uvicorn" version="^0.38.0"/>
        <package name="supabase" version="^2.24.0"/>
        <package name="python-dotenv" version="^1.2.1"/>
        <package name="email-validator" version="^2.1.1"/>
        <package name="pypdf" version="^X.X.X"/>
        <package name="python-docx" version="^X.X.X"/>
        <package name="google-generativeai" version="^X.X.X"/>
      </python>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Utilize a client-side markdown renderer library (e.g., react-markdown) for displaying summary_text.</constraint>
    <constraint>Implement clear visual feedback for loading states (spinners, skeleton UI) and user-friendly error messages for failed or unavailable summaries.</constraint>
    <constraint>Ensure the summary display interface is responsive and maintains readability/usability across desktop, laptop, and tablet devices.</constraint>
    <constraint>Handle large summaries efficiently to ensure the UI remains responsive and loads content without excessive delays.</constraint>
    <constraint>Navigation to the summary view must be intuitive from the main application flow.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Get Summary API</name>
      <kind>REST Endpoint</kind>
      <signature>GET /api/v1/documents/{document_id}/summary</signature>
      <path>backend/app/api/summaries/main.py</path>
    </interface>
    <interface>
      <name>Get Summary Status API</name>
      <kind>REST Endpoint</kind>
      <signature>GET /api/v1/documents/{document_id}/status</signature>
      <path>backend/app/api/summaries/main.py</path>
    </interface>

  <tests>
    <standards>Unit, Integration, and E2E tests are required for the frontend using Jest and Playwright/Cypress. Manual UI/UX review is also essential to ensure a high-quality user experience.</standards>
    <locations>
      <location>frontend/__tests__</location>
    </locations>
    <ideas>
      <idea acId="FR-CIP-2">Test that the frontend successfully fetches the summary content using GET /api/v1/documents/{document_id}/summary.</idea>
      <idea acId="FR-CIP-2">Verify that markdown formatted summary content is correctly rendered in the UI.</idea>
      <idea acId="FR-CIP-2">Test the "Copy Summary" button functionality, ensuring the summary text is accurately copied to the clipboard.</idea>
      <idea acId="FR-CIP-2">Verify the UI displays appropriate loading indicators (spinner, skeleton screen) while the summary is being fetched or generated.</idea>
      <idea acId="FR-CIP-2">Test user-friendly error messages are displayed when summary generation fails or the summary is not yet available.</idea>
      <idea acId="FR-CIP-2">Ensure the system efficiently handles large summaries, maintaining UI responsiveness during display.</idea>
      <idea acId="FR-UI-1">Verify the summary display interface is responsive and maintains readability across desktop, laptop, and tablet screen sizes.</idea>
      <idea acId="FR-UI-1">Test that navigation to the summary view is intuitive and integrated smoothly into the application flow.</idea>
    </ideas>
  </tests>
</story-context>